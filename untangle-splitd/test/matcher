#!/bin/dash

make test_matcher

run_test_matcher()
{
    local t_status="PASSED"
    ./test_matcher "$*" || t_status="FAILED"
    echo "${t_status}: ./test_matcher $*"
}

run_test_matcher t "1.2.3.4" "1.2.3.4" "6.7.8.9 4.3.2.1 255.255.255.255"
 
run_test_matcher t "1.2.3.4/32" \
    "1.2.3.4" \
    "6.7.8.9 4.3.2.1 1.2.3.5 1.2.3.3 255.255.255.255"
 
run_test_matcher t "1.2.3.4/255.255.255.255" \
    "1.2.3.4" \
    "6.7.8.9 4.3.2.1 1.2.3.5 1.2.3.3 255.255.255.255"

run_test_matcher t "1.2.3.0 - 1.2.3.4" \
    "1.2.3.0 1.2.3.1 1.2.3.2 1.2.3.3 1.2.3.4" \
    "1.2.255.255 1.2.3.5 6.7.8.9 4.3.2.1 255.255.255.255"

run_test_matcher t "1.2.3.4 - 1.2.3.0" \
    "1.2.3.0 1.2.3.1 1.2.3.2 1.2.3.3 1.2.3.4" \
    "1.2.255.255 1.2.3.5 6.7.8.9 4.3.2.1 255.255.255.255" 

run_test_matcher t "any" \
    "1.2.3.4 1.2.255.255 1.2.3.5 6.7.8.9 4.3.2.1 255.255.255.255" \
    ""

run_test_matcher t "AnY" \
    "1.2.3.4 1.2.255.255 1.2.3.5 6.7.8.9 4.3.2.1 255.255.255.255" \
    ""

run_test_matcher t "*" \
    "1.2.3.4 1.2.255.255 1.2.3.5 6.7.8.9 4.3.2.1 255.255.255.255" \
    ""

run_test_matcher t "1.2.3.4/0" \
    "1.2.3.4 1.2.255.255 1.2.3.5 6.7.8.9 4.3.2.1 255.255.255.255" \
    ""

run_test_matcher t "1.2.3.4/0.0.0.0" \
    "1.2.3.4 1.2.255.255 1.2.3.5 6.7.8.9 4.3.2.1 255.255.255.255" \
    ""

run_test_matcher t "1.2.3.1, 1.2.3.2 , 1.2.3.7" \
    "1.2.3.1 1.2.3.2 1.2.3.7" \
    "1.2.255.255 1.2.3.5 6.7.8.9 4.3.2.1 255.255.255.255"

run_test_matcher t "1.2.3.1/30" \
    "1.2.3.0 1.2.3.1 1.2.3.2 1.2.3.3" \
    "1.2.255.255 1.2.3.4 1.2.3.5 6.7.8.9 192.168.1.1 4.3.2.1 255.255.255.255"

run_test_matcher t "1.2.3.1/255.255.255.252" \
    "1.2.3.0 1.2.3.1 1.2.3.2 1.2.3.3" \
    "1.2.255.255 1.2.3.4 1.2.3.5 6.7.8.9 192.168.1.1 4.3.2.1 255.255.255.255"

run_test_matcher t "4.3.2.1/31  , 1.2.3.1/30" \
    "1.2.3.0 1.2.3.1 1.2.3.2 1.2.3.3 4.3.2.1" \
    "1.2.255.255 1.2.3.4 1.2.3.5 6.7.8.9 192.168.1.1 255.255.255.255"

run_test_matcher t "4.3.2.1/31,  1.2.3.1, 1.2.3.2, 1.2.3.7" \
    "1.2.3.1 1.2.3.2 1.2.3.7 4.3.2.0 4.3.2.1" \
    "1.2.255.255 1.2.3.5 6.7.8.9 255.255.255.255"

run_test_matcher t "4.3.2.1/31, 1.2.3.1, 1.2.3.2 , 1.2.3.7, 192.168.1.2 - 192.168.1.3" \
    "1.2.3.1 1.2.3.2 1.2.3.7 4.3.2.0 4.3.2.1 192.168.1.2 192.168.1.3" \
    "1.2.255.255 1.2.3.5 6.7.8.9 255.255.255.255 192.168.1.1"

run_test_matcher p "asdf" "1.2.3" "1.2.256.1" "4.3.2.1//2" "4.3.2/2" "4.3.2.1/-1" "4.3.2.1/33"  \
    "4.3.2.1/255.255.255.256" "4.3.2.1/255.255." "4.3.2.1 - " "4.3. - " "4.3. - 6.7.8.9"
