#! /bin/bash

APT_CACHE_DIR="/var/cache/apt/archives"

# is this the best place to do this ?
[[ -x /bin/zsh ]] && chsh -s /bin/zsh root

find /root/.zsh -type f | xargs chmod 640
find /root/.zsh -type d | xargs chmod 750

# Fix timezone
[ -f /usr/share/untangle/conf/timezone ] && cat /usr/share/untangle/conf/timezone > /etc/timezone

# Have cron.daily run earlier in the day, at a random time between 1:00 and 2:00
CRONTAB_FILE=/etc/crontab
if [ -f "${CRONTAB_FILE}" ] ; then
    let "ranmin = $RANDOM % 60"
    grep -sq "^25 6" ${CRONTAB_FILE} && sed -i -e "s|^25 6|${ranmin} 1|" ${CRONTAB_FILE}
fi

# Fix up boxes so they don't fsck after 6 months.  Now only limit is 32 reboots.
rootdev=`awk '/ \/ / {print $1}' /etc/mtab`
if [ -n "$rootdev" -a -f /etc/fstab ]; then
    # Special handling for install-time when /etc/mtab isn't valid
    rootdev=`awk '/ \/ / {print $1}' /etc/fstab`
fi
tune2fs -i 0 $rootdev

exit 0
