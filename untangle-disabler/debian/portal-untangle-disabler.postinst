#!/bin/sh

if [ -f /usr/share/untangle/conf/trials/portal.expired ] ; then

    # trial already used - disable immediately
    /usr/bin/mcli disable portal-transform &> /dev/null &

    # change extraname to trial expired
    /usr/bin/mcli extraname portal-transform "Trial (Expired)" &> /dev/null &

else

    # change extraname to trial
    /usr/bin/mcli extraname portal-transform "Trial (30 days remain)" &> /dev/null &

    for i in `seq 29` ; do 
        echo "/usr/bin/mcli extraname portal-transform \"Trial ($((30-$i)) days remain)\"" | at +$i days &> /dev/null
    done

    # schedule disabling - this gets double checked by the cron job
    echo "/usr/share/untangle/bin/utdisable portal-transform &> /dev/null" | at "+30 days" &> /dev/null
    mkdir -p /usr/share/untangle/conf/trials &> /dev/null
fi


exit 0
